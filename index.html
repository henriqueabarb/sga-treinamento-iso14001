<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGA - Registro de Competência ISO 14001</title>
    <!-- Carregamento do Tailwind CSS para estilo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'iso-success': '#10B981', // Verde: Em Dia
                        'iso-warning': '#F59E0B', // Amarelo: Atenção
                        'iso-danger': '#EF4444', // Vermelho: Vencido
                        'iso-neutral': '#6B7280', // Cinza: Pendente
                        'app-bg': '#F9FAFB',
                        'app-primary': '#1F2937',
                    }
                }
            }
        }
    </script>
    <!-- Configurações e Estilos -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .card { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1); }
        .status-em-dia { background-color: #10B981; }
        .status-atencao { background-color: #F59E0B; }
        .status-vencido { background-color: #EF4444; }
        .status-pendente { background-color: #6B7280; }
        /* Garante que o container principal da aplicação tenha altura mínima para centralização visual */
        #app-container { min-height: calc(100vh - 4rem); } 
        /* Estilo para a matícula do usuário atual (Importante para multi-usuário) */
        #userIdDisplay { word-break: break-all; font-size: 0.75rem; color: #6B7280; }
    </style>
</head>
<body class="p-4 sm:p-8">

    <!-- Tela de Login -->
    <div id="login-screen" class="max-w-md mx-auto bg-white p-8 rounded-xl shadow-2xl transition-opacity duration-500">
        <h1 class="text-2xl font-bold text-app-primary mb-4 text-center">Login SGA</h1>
        <p class="text-gray-600 mb-6 text-center">Insira sua matrícula para acessar o painel de competência.</p>
        <input type="text" id="matricula-input" placeholder="Ex: 12345 (Funcionário) ou GESTOR" class="w-full p-3 mb-4 border border-gray-300 rounded-lg focus:ring-iso-success focus:border-iso-success">
        <button id="login-button" class="w-full bg-app-primary text-white p-3 rounded-lg font-semibold hover:bg-gray-700 transition-colors">Acessar Sistema</button>
        <p class="mt-4 text-sm text-gray-500 text-center">Use 'GESTOR' para o painel de indicadores.</p>
    </div>

    <!-- Container Principal da Aplicação -->
    <div id="app-container" class="hidden max-w-7xl mx-auto">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-app-primary">Gestão de Competência ISO 14001</h1>
            <p id="userIdDisplay" class="mt-1 text-xs">Matrícula Atual: N/A</p>
        </header>

        <!-- Navegação (Tabs) -->
        <div class="flex border-b border-gray-200 mb-6">
            <button id="tab-gestor" class="py-2 px-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-app-primary hover:border-app-primary transition-colors">Painel do Gestor</button>
            <button id="tab-funcionario" class="py-2 px-4 text-sm font-medium border-b-2 border-app-primary text-app-primary transition-colors">Painel do Funcionário</button>
        </div>

        <!-- Conteúdo do Painel do Funcionário -->
        <section id="panel-funcionario" class="space-y-6">
            <h2 class="text-xl font-semibold text-app-primary">Meus Treinamentos Obrigatórios</h2>
            <div id="loading-funcionario" class="text-center text-gray-500">Carregando dados de conformidade...</div>
            <div id="funcionario-list" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
                <!-- Cards de Treinamento serão injetados aqui -->
            </div>
            
            <!-- Modal de Mensagem (para substituir o alert) -->
            <div id="message-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
                <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
                    <div class="mt-3 text-center">
                        <h3 id="modal-title" class="text-lg leading-6 font-medium text-gray-900">Mensagem do Sistema</h3>
                        <div class="mt-2 px-7 py-3">
                            <p id="modal-body" class="text-sm text-gray-500">...</p>
                        </div>
                        <div class="items-center px-4 py-3">
                            <button id="modal-close-button" class="px-4 py-2 bg-app-primary text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-app-primary">
                                Fechar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Conteúdo do Painel do Gestor (Hidden por default) -->
        <section id="panel-gestor" class="hidden space-y-8">
            <h2 class="text-xl font-semibold text-app-primary">Indicadores de Conformidade</h2>

            <!-- Cartões de Indicadores -->
            <div class="grid gap-6 sm:grid-cols-3">
                <div id="card-em-dia" class="card p-5 bg-iso-success text-white rounded-lg">
                    <p class="text-sm font-medium">Em Dia</p>
                    <p id="count-em-dia" class="text-3xl font-bold mt-1">0</p>
                </div>
                <div id="card-atencao" class="card p-5 bg-iso-warning text-white rounded-lg">
                    <p class="text-sm font-medium">Em Atenção</p>
                    <p id="count-atencao" class="text-3xl font-bold mt-1">0</p>
                </div>
                <div id="card-vencido" class="card p-5 bg-iso-danger text-white rounded-lg">
                    <p class="text-sm font-medium">Vencido/Pendente</p>
                    <p id="count-vencido" class="text-3xl font-bold mt-1">0</p>
                </div>
            </div>

            <!-- Tabela de Rastreabilidade Completa -->
            <div>
                <h3 class="text-lg font-semibold mb-3 text-app-primary">Rastreabilidade da Equipe</h3>
                <div id="loading-gestor" class="text-center text-gray-500">Carregando rastreabilidade da equipe...</div>
                <div class="bg-white rounded-lg shadow-md overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Matrícula</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Treinamento</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Última Conclusão</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Validade</th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            </tr>
                        </thead>
                        <tbody id="gestor-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- Linhas da tabela serão injetadas aqui -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </div>

    <!-- Firebase Imports e Script Principal -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, collection, query, where, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- CONFIGURAÇÃO MANUAL DO FIREBASE (Substituindo variáveis de ambiente) ---
        // ESTA É A SUA CONFIGURAÇÃO REAL OBTIDA DO CONSOLE DO FIREBASE:
        const firebaseConfig = {
          apiKey: "AIzaSyBVyqEhlJsxuLeQrtjZRS538JZf28Pqtbk",
          authDomain: "sga-treinamento-goias.firebaseapp.com",
          projectId: "sga-treinamento-goias",
          storageBucket: "sga-treinamento-goias.firebasestorage.app",
          messagingSenderId: "1072216886470",
          appId: "1:1072216886470:web:0788e8f46a234189c19bc7"
        };

        // Usa o projectId como AppId para consistência com o caminho do Firestore
        const appId = firebaseConfig.projectId; 
        // Define initialAuthToken como null, pois usaremos autenticação anônima
        const initialAuthToken = null; 
        
        // Variáveis globais
        let app, db, auth, userId;
        let currentMatricula = localStorage.getItem('currentMatricula') || null;
        setLogLevel('Debug'); // Habilita logs para depuração

        // --- DADOS MOCK (Catálogo de Treinamentos, simulando o Backend Java) ---
        const TREINAMENTOS = [
            { id: 'T101', titulo: 'Aspectos e Impactos Ambientais (ISO 14001)', periodicidade: 365, relevancia: 'ISO, Legal' },
            { id: 'T102', titulo: 'Gerenciamento de Resíduos Sólidos', periodicidade: 180, relevancia: 'Legal, Operacional (Goiás)' },
            { id: 'T103', titulo: 'Uso Racional da Água', periodicidade: 540, relevancia: 'ISO, Operacional' },
            { id: 'T104', titulo: 'Legislação do ICMS Ecológico (Goiás)', periodicidade: 730, relevancia: 'Legal, Administrativo' },
        ];
        
        // --- FUNÇÕES DE CONFORMIDADE E LÓGICA DE NEGÓCIO ---

        /**
         * Calcula o status de conformidade baseado na data de validade.
         * Esta é a lógica de negócio central (antigo ConformidadeService.java).
         * @param {Date | null} dataValidade Data de expiração do treinamento.
         * @returns {string} Status ('Em Dia', 'Atenção', 'Vencido', 'Pendente').
         */
        function calcularStatus(dataValidade) {
            if (!dataValidade || isNaN(new Date(dataValidade))) return 'Pendente'; 

            const hoje = new Date();
            const validade = new Date(dataValidade);
            const diffTime = validade.getTime() - hoje.getTime();
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays <= 0) return 'Vencido'; // Data expirou
            if (diffDays <= 30) return 'Atenção'; // 30 dias de aviso
            return 'Em Dia';
        }

        /**
         * Gera o caminho da coleção no Firestore para os registros de conformidade (Coleção Pública).
         */
        function getRegistrosCollection() {
            // Caminho: /artifacts/{projectId}/public/data/registros_conformidade
            return collection(db, `/artifacts/${appId}/public/data/registros_conformidade`);
        }

        // --- FUNÇÕES DE PERSISTÊNCIA (Simulação do Repository/Controller) ---

        /**
         * Registra a conclusão de um treinamento (POST /api/registro).
         * @param {string} matricula Matrícula do funcionário.
         * @param {string} treinamentoId ID do treinamento concluído.
         */
        async function registrarConclusao(matricula, treinamentoId) {
            const treinamento = TREINAMENTOS.find(t => t.id === treinamentoId);
            if (!treinamento) throw new Error("Treinamento não encontrado.");

            const dataConclusao = new Date();
            const validadeMillis = treinamento.periodicidade * 24 * 60 * 60 * 1000;
            const dataValidade = new Date(dataConclusao.getTime() + validadeMillis);
            
            // O Firestore não aceita vírgulas em IDs de documentos
            const docId = `${matricula}_${treinamentoId}`; 

            const novoRegistro = {
                matricula: matricula,
                treinamentoId: treinamentoId,
                dataConclusao: serverTimestamp(), // Firestore Timestamp para auditoria
                dataValidade: dataValidade.toISOString(), // Salva como string ISO para cálculo
                periodicidadeDias: treinamento.periodicidade,
            };

            try {
                // Upsert: Adiciona ou atualiza o registro usando o docId único
                const docRef = doc(getRegistrosCollection(), docId);
                await setDoc(docRef, novoRegistro);
                return `Conclusão registrada com sucesso! Próxima validade: ${new Date(dataValidade).toLocaleDateString('pt-BR')}.`;
            } catch (error) {
                console.error("Erro ao registrar conclusão no Firestore:", error);
                throw new Error("Falha ao salvar o registro no banco de dados. Verifique as Regras de Segurança do Firestore.");
            }
        }

        // --- FUNÇÕES DE INTERFACE (Rendering) ---

        /** Exibe uma mensagem modal na tela. */
        function showModal(title, body) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-body').innerHTML = body;
            document.getElementById('message-modal').classList.remove('hidden');
        }

        /** Renderiza os cards de treinamento para o painel do funcionário. */
        function renderFuncionarioPanel(registros) {
            const container = document.getElementById('funcionario-list');
            container.innerHTML = '';
            document.getElementById('loading-funcionario').classList.add('hidden');
            
            // Mapeia registros por ID do treinamento para acesso rápido
            const dataMap = registros.reduce((acc, reg) => {
                acc[reg.treinamentoId] = reg;
                return acc;
            }, {});

            TREINAMENTOS.forEach(treinamento => {
                const registro = dataMap[treinamento.id] || null;
                const dataValidade = registro ? new Date(registro.dataValidade) : null;
                const status = calcularStatus(dataValidade);

                let colorClass, statusText, actionEnabled;
                if (status === 'Em Dia') { colorClass = 'bg-iso-success'; statusText = `Válido até: ${dataValidade.toLocaleDateString('pt-BR')}`; actionEnabled = false; }
                else if (status === 'Atenção') { colorClass = 'bg-iso-warning'; statusText = `ATENÇÃO! Vence em: ${dataValidade.toLocaleDateString('pt-BR')}`; actionEnabled = true; }
                else if (status === 'Vencido') { colorClass = 'bg-iso-danger'; statusText = `VENCIDO desde: ${dataValidade.toLocaleDateString('pt-BR')}`; actionEnabled = true; }
                else { colorClass = 'bg-iso-neutral'; statusText = 'Pendente de Conclusão'; actionEnabled = true; }
                
                // Formata a data de validade para exibição no card
                const validadeText = dataValidade ? dataValidade.toLocaleDateString('pt-BR') : 'N/A';

                const card = `
                    <div class="card p-5 bg-white rounded-xl shadow-lg border-l-4 ${colorClass.replace('bg-', 'border-')}">
                        <h4 class="text-lg font-semibold text-app-primary mb-2">${treinamento.titulo}</h4>
                        <p class="text-sm text-gray-600">Periodicidade: ${treinamento.periodicidade} dias</p>
                        <p class="text-sm text-gray-600">Relevância: ${treinamento.relevancia}</p>
                        <p class="text-sm font-semibold mt-2 text-gray-700">Validade: ${validadeText}</p>
                        <span class="inline-block px-3 py-1 mt-2 text-xs font-semibold text-white rounded-full ${colorClass}">${statusText}</span>
                        ${actionEnabled ? `
                            <button data-treinamento-id="${treinamento.id}" 
                                    class="btn-concluir w-full mt-4 bg-app-primary text-white p-2 rounded-lg text-sm font-medium hover:bg-gray-700 transition-colors">
                                Confirmar Conclusão Agora
                            </button>
                        ` : `<button disabled class="w-full mt-4 bg-gray-300 text-gray-600 p-2 rounded-lg text-sm font-medium">Em Dia</button>`}
                    </div>
                `;
                container.innerHTML += card;
            });

            // Adiciona evento de clique para os botões de concluir
            document.querySelectorAll('.btn-concluir').forEach(button => {
                button.onclick = async (e) => {
                    const id = e.target.getAttribute('data-treinamento-id');
                    e.target.disabled = true;
                    e.target.textContent = 'Registrando...';
                    try {
                        const message = await registrarConclusao(currentMatricula, id);
                        showModal("Registro de Conclusão", message);
                    } catch (error) {
                        showModal("Erro no Registro", error.message);
                    } finally {
                        // Força o recarregamento dos dados via listener do Firestore
                    }
                };
            });
        }

        /** Renderiza a tabela e os indicadores do painel do gestor. */
        function renderGestorPanel(todosRegistros) {
            const tableBody = document.getElementById('gestor-table-body');
            tableBody.innerHTML = '';
            document.getElementById('loading-gestor').classList.add('hidden');

            const statusCounts = { 'Em Dia': 0, 'Atenção': 0, 'Vencido': 0, 'Pendente': 0 };
            
            // Mapeia o pior status de cada funcionário para contagem no Dashboard
            const pioresStatusPorMatricula = new Map();

            todosRegistros.forEach(reg => {
                const dataValidade = new Date(reg.dataValidade);
                const status = calcularStatus(dataValidade);
                
                // Verifica o status geral do funcionário (lógica simplificada: conta todos os registros)
                if (statusCounts.hasOwnProperty(status)) {
                    statusCounts[status]++;
                } 

                // --- Renderiza linha da tabela de rastreabilidade completa ---
                let colorClass;
                if (status === 'Em Dia') { colorClass = 'bg-iso-success'; }
                else if (status === 'Atenção') { colorClass = 'bg-iso-warning'; }
                else if (status === 'Vencido') { colorClass = 'bg-iso-danger'; }
                else { colorClass = 'bg-iso-neutral'; }
                
                const treinamento = TREINAMENTOS.find(t => t.id === reg.treinamentoId)?.titulo || 'Desconhecido';
                
                // Formata dataConclusao se for um objeto Timestamp do Firestore
                let dataConcText = reg.dataConclusao?.toDate() ? reg.dataConclusao.toDate().toLocaleDateString('pt-BR') : 'N/A';
                
                const row = `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${reg.matricula}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${treinamento}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${dataConcText}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${dataValidade.toLocaleDateString('pt-BR')}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full text-white ${colorClass}">
                                ${status}
                            </span>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
            
            // Atualiza Cartões de Indicadores (combina Vencido e Pendente no risco)
            document.getElementById('count-em-dia').textContent = statusCounts['Em Dia'];
            document.getElementById('count-atencao').textContent = statusCounts['Atenção'];
            document.getElementById('count-vencido').textContent = statusCounts['Vencido'] + statusCounts['Pendente'];
        }

        // --- FUNÇÕES DE SETUP E AUTENTICAÇÃO ---

        /** Inicializa o Firebase e a Autenticação. */
        async function initializeFirebase() {
            try {
                if (!firebaseConfig.apiKey) {
                    showModal("Erro Crítico", "As chaves do Firebase não foram configuradas. Por favor, insira as chaves reais.");
                    return;
                }
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Autenticação: Garante que o usuário esteja autenticado (Autenticação Anônima)
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log("Usuário Firebase autenticado:", userId);
                        // Se houver uma matrícula em localStorage, tenta carregar o app
                        if (currentMatricula) {
                            handleLogin(currentMatricula, true);
                        } else {
                             // Caso não haja sessão, o usuário permanece na tela de login
                             document.getElementById('login-screen').classList.remove('hidden');
                        }
                    } else {
                        console.log("Usuário deslogado ou anônimo.");
                        // Força o usuário a fazer o login manual se a autenticação falhar
                        document.getElementById('login-screen').classList.remove('hidden');
                    }
                });

            } catch (error) {
                console.error("Erro na inicialização ou autenticação do Firebase:", error);
                showModal("Erro Crítico", `Falha ao iniciar o banco de dados em nuvem. Verifique suas chaves e o Console. (${error.message})`);
                document.getElementById('login-screen').classList.remove('hidden');
            }
        }

        /** Lida com o fluxo de login e carrega a interface correta. */
        function handleLogin(matricula, isSessionResume = false) {
            matricula = matricula.toUpperCase().trim();
            if (!matricula) {
                showModal("Erro de Login", "Por favor, insira sua matrícula.");
                return;
            }

            currentMatricula = matricula;
            localStorage.setItem('currentMatricula', currentMatricula);
            
            // Esconde login e mostra a aplicação
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('app-container').classList.remove('hidden');
            document.getElementById('userIdDisplay').textContent = `Matrícula: ${currentMatricula} (UID: ${userId})`;

            // Decide qual painel mostrar
            if (currentMatricula === 'GESTOR') {
                showPanel('gestor');
                // O listener só deve ser setado uma vez
                if (!isSessionResume) setupFirestoreListeners('gestor'); 
            } else {
                showPanel('funcionario');
                if (!isSessionResume) setupFirestoreListeners('funcionario');
            }
        }
        
        /** Configura o listener em tempo real (onSnapshot) do Firestore. */
        function setupFirestoreListeners(panel) {
            if (!db || !userId) return; // Garante que o Firebase está pronto

            if (panel === 'funcionario' && currentMatricula !== 'GESTOR') {
                // Filtra apenas os registros do usuário atual (simulando POST /api/conformidade/{matricula})
                const q = query(getRegistrosCollection(), where("matricula", "==", currentMatricula));
                onSnapshot(q, (snapshot) => {
                    const registros = snapshot.docs.map(doc => doc.data());
                    renderFuncionarioPanel(registros);
                }, (error) => {
                    console.error("Erro no listener do Funcionário:", error);
                    showModal("Erro de Conexão", "Não foi possível carregar seus registros de treinamento.");
                });
            } else if (panel === 'gestor' && currentMatricula === 'GESTOR') {
                // Busca *todos* os registros (simulando GET /api/indicadores/geral)
                const q = query(getRegistrosCollection());
                onSnapshot(q, (snapshot) => {
                    const todosRegistros = snapshot.docs.map(doc => doc.data());
                    renderGestorPanel(todosRegistros);
                }, (error) => {
                    console.error("Erro no listener do Gestor:", error);
                    showModal("Erro de Conexão", "Não foi possível carregar os indicadores da equipe.");
                });
            }
        }

        /** Alterna entre os painéis Gestor e Funcionário. */
        function showPanel(panel) {
            const isGestor = panel === 'gestor';
            
            // Só permite a navegação para o Gestor se a matrícula for GESTOR
            if (isGestor && currentMatricula !== 'GESTOR') {
                showModal("Acesso Negado", "Você não tem permissão para acessar o Painel do Gestor. Matrícula inválida.");
                showPanel('funcionario'); // Retorna ao painel de funcionário
                return;
            }
            
            document.getElementById('panel-gestor').classList.toggle('hidden', !isGestor);
            document.getElementById('panel-funcionario').classList.toggle('hidden', isGestor);
            
            // Atualiza o estado da aba
            document.getElementById('tab-gestor').classList.toggle('text-app-primary', isGestor);
            document.getElementById('tab-gestor').classList.toggle('border-app-primary', isGestor);
            document.getElementById('tab-gestor').classList.toggle('text-gray-500', !isGestor);
            document.getElementById('tab-gestor').classList.toggle('border-transparent', !isGestor);

            document.getElementById('tab-funcionario').classList.toggle('text-app-primary', !isGestor);
            document.getElementById('tab-funcionario').classList.toggle('border-app-primary', !isGestor);
            document.getElementById('tab-funcionario').classList.toggle('text-gray-500', isGestor);
            document.getElementById('tab-funcionario').classList.toggle('border-transparent', isGestor);
            
            // Se mudar para gestor, força a renderização se já estivermos logados
            if(isGestor && currentMatricula === 'GESTOR') setupFirestoreListeners('gestor');
            else if (!isGestor && currentMatricula !== 'GESTOR') setupFirestoreListeners('funcionario');
        }

        // --- Event Listeners Globais ---
        document.addEventListener('DOMContentLoaded', () => {
            initializeFirebase(); // Inicia o Firebase
            
            // Login Screen
            document.getElementById('login-button').addEventListener('click', () => {
                const matricula = document.getElementById('matricula-input').value;
                handleLogin(matricula);
            });
            document.getElementById('matricula-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    document.getElementById('login-button').click();
                }
            });

            // Tabs
            document.getElementById('tab-gestor').addEventListener('click', () => showPanel('gestor'));
            document.getElementById('tab-funcionario').addEventListener('click', () => showPanel('funcionario'));

            // Modal Close
            document.getElementById('modal-close-button').addEventListener('click', () => {
                document.getElementById('message-modal').classList.add('hidden');
            });
        });
    </script>
</body>
</html>
